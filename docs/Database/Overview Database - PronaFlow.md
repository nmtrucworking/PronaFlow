*Sơ đồ này được xây dựng để hỗ trợ tất cả các tính năng được thể hiện trong giao diện người dùng, từ quản lý người dùng, không gian làm việc, dự án, công việc, cho đến các tính năng phụ như tag, thông báo, và lưu trữ.*
1. Chi tiết thiết kế các bảng dữ liệu: [[Database - PronaFlow]]
2. UserFlow: [[UserFlow - PronaFlow]]
# Thống kê Tổng quan:

| Loại thành phần                 | Tên / Mô tả                                                                                                                                                                                                                                                                                                                                                                   | Số lượng        | Ghi chú                                                                |
| ------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------- | ---------------------------------------------------------------------- |
| **Bảng dữ liệu <br>(tables)**   | 1. users<br>2. workspaces<br>3. projects<br>4. task_lists<br>5. tasks<br>6. subtasks<br>7. tags<br>8. activities<br>9. project_members<br>10. task_assignees<br>11. project_tags<br>12. notification_recipients<br>13. attachments<br>14. comments                                                                                                                            | **14**          | Bao gồm bảng chính và các bảng nối (junction tables).                  |
| **Khóa ngoại<br>(FK)**          | users → workspaces<br>workspaces → projects<br>projects → task_lists<br>task_lists → tasks<br>tasks → subtasks<br>tasks ↔ users (task_assignees)<br>projects ↔ users (project_members)<br>projects ↔ tags (project_tags)<br>activities → users<br>notification_recipients ↔ activities & users                                                                                | ≈ **15 FK**     | Các mối quan hệ Một-Nhiều và Nhiều-Nhiều được định nghĩa rõ.           |
| **Trigger** _(gợi ý nên có)_    | 1️⃣ `trg_AutoCreateWorkspace` — tự tạo workspace mặc định khi thêm user mới.<br>2️⃣ `trg_UpdateProjectType` — đổi `project_type` khi thêm thành viên mới vào dự án.<br>3️⃣ `trg_SoftDeleteProject` — đánh dấu `is_deleted = 1` thay vì xóa vật lý.<br>4️⃣ `trg_CreateActivity` — tạo log trong `activities` khi có hành động chính (tạo task, gán task, thay đổi trạng thái). | **4–5 trigger** | Có thể mở rộng thêm trigger cho thông báo (`notification_recipients`). |
| **View** <br>_(tùy chọn)_       | `vw_MyTasks`, <br>`vw_ProjectSummary`, <br>`vw_ActivityFeed`                                                                                                                                                                                                                                                                                                                  | 3               | Phục vụ Dashboard & MyTask.                                            |
| **Index**                       | Index cho các FK (`project_id`, `task_id`, `workspace_id`, `user_id`), và các cột thường lọc (`status`, `priority`, `end_date`)                                                                                                                                                                                                                                               | 10+             | Tối ưu tốc độ truy vấn.                                                |
| **Stored Procedures** _(gợi ý)_ | `sp_CreateUserWithDefaultWorkspace`, <br>`sp_AssignTask`, <br>`sp_ArchiveProject`, <br>`sp_GetUserDashboard`                                                                                                                                                                                                                                                                  | 4–6             | Dễ bảo trì logic nghiệp vụ.                                            |

# Bảng Thống Kê Tổng Hợp Hệ Thống Dữ Liệu & Nghiệp Vụ PronaFlow
Bảng này cung cấp một cái nhìn tổng quan, từ cấu trúc cơ sở dữ liệu nền tảng đến các quy tắc nghiệp vụ phức tạp, giúp bạn có một bức tranh hoàn chỉnh về kiến trúc của ứng dụng.

| Hạng Mục                              | Thành Phần & Nghiệp Vụ Chính                                                                                                                                                                                                                                                                      | Ghi Chú & Tác Động                                                                                |
| :------------------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :------------------------------------------------------------------------------------------------ |
| **I. MÔ HÌNH DỮ LIỆU CỐT LÕI**        | **14 Bảng Dữ Liệu:**<br>- **10 Bảng chính:** `users`, `workspaces`, `projects`, `task_lists`, `tasks`, `subtasks`, `tags`, `activities`, `attachments`, `comments`.<br>- **4 Bảng nối:** `project_members`, `task_assignees`, `project_tags`, `notification_recipients`.                          | Nền tảng vững chắc, bao quát toàn bộ các thực thể cần thiết cho ứng dụng.                         |
|                                       | **Mối quan hệ chính:**<br>- **1-Nhiều:** `Users` -> `Workspaces`, `Workspaces` -> `Projects`, `Projects` -> `Tasks`.<br>- **Nhiều-Nhiều:** `Users` <-> `Projects`, `Users` <-> `Tasks`.<br>- **Đa hình (Polymorphic):** `Attachments` và `Comments` có thể liên kết với cả `Projects` và `Tasks`. | Cấu trúc quan hệ rõ ràng, linh hoạt và có khả năng mở rộng cao cho các tính năng trong tương lai. |
| **II. QUẢN LÝ NGƯỜI DÙNG & TRUY CẬP** | **Xác thực (Authentication):**<br>- Đăng nhập/Đăng ký bằng `email` & `password_hash`.<br>- Luồng "Quên mật khẩu" với bảng `password_resets` và token.                                                                                                                                             | Đảm bảo an toàn cho tài khoản người dùng.                                                         |
|                                       | **Phân quyền (Authorization):**<br>- **Cấp hệ thống:** `users.role` (`user`, `admin`) để quản lý toàn cục.<br>- **Cấp dự án:** `project_members.role` (`admin`, `member`) để quản lý quyền hạn trong từng dự án cụ thể.                                                                           | Phân chia quyền hạn rõ ràng, đảm bảo người dùng chỉ có thể thực hiện các hành động được phép.     |
|                                       | **Hệ thống Lời mời (Invitation System):**<br>- Bảng `invitations` để quản lý lời mời vào dự án qua email.<br>- Xử lý cho cả người dùng đã có và chưa có tài khoản.                                                                                                                                | Cốt lõi cho tính năng làm việc nhóm, cho phép mở rộng đội ngũ một cách an toàn và chuyên nghiệp.  |
| **III. NGHIỆP VỤ TÍNH NĂNG CỐT LÕI**  | **Quản lý Vòng đời (Lifecycle):**<br>- **Xóa mềm (Thùng rác):** `is_deleted` & `deleted_at` trong `projects` và `tasks` với cơ chế tự động xóa sau 30 ngày.<br>- **Lưu trữ (Archive):** `is_archived` trong `projects` để ẩn dự án khỏi giao diện chính.                                          | Đảm bảo người dùng không bị mất dữ liệu do nhầm lẫn và giúp không gian làm việc luôn gọn gàng.    |
|                                       | **Phân loại & Tổ chức:**<br>- `project_type` (`personal`, `team`) để phân biệt dự án cá nhân và nhóm.<br>- Bảng `tags` để gắn nhãn và lọc dự án theo danh mục.                                                                                                                                    | Tăng khả năng tổ chức và tìm kiếm thông tin một cách trực quan.                                   |
|                                       | **Luồng Hoạt động & Thông báo (`activities`):**<br>- Ghi lại chi tiết mọi hành động quan trọng (`action_type`).<br>- Tự động tạo thông báo cho người liên quan (`notification_recipients`).                                                                                                       | Tạo ra một môi trường làm việc minh bạch, tương tác cao và đảm bảo không ai bỏ lỡ thông tin.      |
|                                       | **Tệp đính kèm & Bình luận (`attachments`, `comments`):**<br>- Cho phép đính kèm tệp và thảo luận trực tiếp trên dự án/công việc.                                                                                                                                                                 | Tăng cường khả năng giao tiếp và tập trung hóa tài nguyên liên quan đến công việc.                |
| **IV. TỰ ĐỘNG HÓA & WORKFLOW**        | **Tự động hóa Quy trình:**<br>- Tự động tạo Workspace đầu tiên khi người dùng mới đăng ký.<br>- Tự động chuyển `project_type` từ `personal` sang `team` khi mời thành viên đầu tiên.                                                                                                              | Giảm thiểu thao tác thủ công và tạo ra trải nghiệm người dùng mượt mà, thông minh.                |
|                                       | **Công việc Lặp lại (Recurring Tasks):**<br>- `is_recurring` và `recurrence_rule` trong bảng `tasks` để thiết lập công việc định kỳ.<br>- Yêu cầu tác vụ nền (cron job) để tự động tạo công việc mới.                                                                                             | Tiết kiệm thời gian cho người dùng đối với các nhiệm vụ lặp đi lặp lại.                           |
|                                       | **Sự phụ thuộc Công việc (Task Dependencies):**<br>- Bảng nối `task_dependencies` để thiết lập mối quan hệ "việc này phải xong trước việc kia".                                                                                                                                                   | Hỗ trợ các quy trình làm việc phức tạp, đảm bảo công việc được thực hiện đúng trình tự.           |
|                                       | **Thông báo Hệ thống Tự động:**<br>- `system_deadline_reminder` & `system_task_overdue` trong `activities` do hệ thống tự tạo ra.                                                                                                                                                                 | Chủ động nhắc nhở người dùng về các deadline quan trọng, nâng cao hiệu suất.                      |
| **V. HIỆU SUẤT & BẢO MẬT**            | **Tối ưu Hiệu suất:**<br>- Sử dụng `Indexes` trên các khóa ngoại và các cột lọc/sắp xếp.<br>- Gợi ý sử dụng **Full-Text Search** cho tính năng tìm kiếm nâng cao.                                                                                                                                 | Đảm bảo ứng dụng phản hồi nhanh ngay cả khi lượng dữ liệu lớn.                                    |
|                                       | **Toàn vẹn Dữ liệu:**<br>- Sử dụng `ON DELETE CASCADE` để đảm bảo dữ liệu con được xóa theo khi đối tượng cha bị xóa vĩnh viễn.<br>- Sử dụng `ENUM` để đảm bảo tính nhất quán của dữ liệu trạng thái.                                                                                             | Giữ cho cơ sở dữ liệu luôn sạch sẽ và logic.                                                      |
|                                       | **Bảo mật Phiên đăng nhập:**<br>- Sử dụng **JWT** (`access_token`, `refresh_token`) để quản lý phiên đăng nhập an toàn.                                                                                                                                                                           | Bảo vệ tài khoản người dùng khỏi các truy cập trái phép.                                          |
| **VI. VẬN HÀNH & BẢO TRÌ**            | **Giám sát hệ thống:**<br>- **Ghi Log Lỗi (System Logging):** Ghi lại các lỗi hệ thống để gỡ lỗi và bảo trì (tách biệt với `activities`).<br>- **Vai trò Super Admin:** Quản lý toàn bộ người dùng và dữ liệu từ một giao diện quản trị riêng.                                                    | Giúp đội ngũ phát triển dễ dàng theo dõi sức khỏe của ứng dụng, xử lý sự cố và quản lý hệ thống.  |
# Nghiệp vụ tự động hóa & Workflow nâng cao.
1. Công việc Lặp lại (Recurring Tasks)
2. Sự phụ thuộc giữa các công việc (Task Dependencies).
# III. Ghi Chú Bổ Sung
## III.1 Note
*   **Indexes**: Để tăng tốc độ truy vấn, bạn nên tạo chỉ mục (index) cho tất cả các cột `FOREIGN KEY` và các cột thường được dùng để lọc dữ liệu như `status`, `priority`, `end_date`.
*   **ON DELETE CASCADE**: Cân nhắc sử dụng `ON DELETE CASCADE` cho các foreign key. Ví dụ, khi một `project` bị xóa vĩnh viễn, tất cả `tasks`, `task_lists`, `subtasks` liên quan cũng nên được tự động xóa theo.
*   **Data Types**: `INT` hoặc `BIGINT` cho khóa chính tùy thuộc vào quy mô dự kiến của ứng dụng. `TIMESTAMP WITH TIME ZONE` được khuyến khích sử dụng thay cho `TIMESTAMP` để xử lý tốt hơn các múi giờ khác nhau.
## 2. Logic Hiển thị "Tất cả trong một" (The Unified View):
- Các trang như My Task, My Calendar và Dashboard sẽ tổng hợp dữ liệu dựa trên ID của người dùng đang đăng nhập.
- Phân luồng cụ thể cho 3 trang trên:
	1. Dashboard:
	2. My Tasks: Hệ thống sẽ lấy tất cả các `task_id` từ bảng `task_asignees` nơi `user_id` là của bạn, bất kể các task đó thuộc dự án nào hay dự án đó nằm trong workspace của ai.
	3. My Calendar:
**5. Hoàn Thiện Logic "Unified View"**

Phần "Logic Hiển thị Tất cả trong một" của bạn đã có ý tưởng chính. Đây là cách hoàn thiện nó:
- **Dashboard:**
    - **Overview Widget:** Đếm tổng số projects mà user_id hiện tại là thành viên (project_members).
    - **Task in progress Widget:** Đếm số tasks được gán cho user_id hiện tại (task_assignees) VÀ có status = 'in-progress'.
    - **Task Overdue Widget:** Đếm số tasks được gán cho user_id hiện tại VÀ có end_date trong quá khứ và is_completed = FALSE.
- **My Calendar:**
    - Truy vấn tất cả các tasks có start_date hoặc end_date không rỗng VÀ được gán cho user_id hiện tại. Hiển thị các task này lên lịch.
# IV. Mô tả Website (tạm thời giữ nguyê, sẽ chỉnh sửa nội dung sau)
## 1. Mô tả chung:
PronaFlow là một nền tảng quảng lý công việc và dự án trực tuyến được thiết kế với giao diện trực quan, linh hoạt và hiện đại.

## 1. Ngôi nhà của Bạn: `Default Workspace`
Ngay khi bạn tham gia, một `Default Workspace` sẽ được tạo ra dành riêng cho bạn. Đây là không gian cốt lỗi, không thể xóa và là nơi tổng hợp mọi thú liên quan đến bạn.
- **Dự án cá nhân:** Tất cả các dự án do chính bạn khởi tạo sẽ được đặt tại đây. Bạn có toàn quyền quản lý, sắp xếp và tùy chỉnh chúng.
- **Trung tâm dự án nhóm:** Điều kỳ diệu xảy ra ở đây! Bất cứ khi nào một đồng nghiệp mời bạn tham gia vào một **Project** của họ, dự án đó sẽ **tự động xuất hiện** trong Workspace Mặc Định của bạn. Bạn không cần phải chuyển đổi qua lại giữa các không gian khác nhau để tìm kiếm công việc. Mọi thứ bạn cần làm, dù là cá nhân hay làm việc nhóm, đều hội tụ tại một nơi duy nhất.
## 2. **Mở rộng *Không gian***: Tạo thêm `Workspace` khi cần.
Khi công việc của bạn phát triển và bạn muốn có sự tách biệt rõ ràng hơn, bạn hoàn toàn có thể tạo thêm các **`workspaces`** mới.
- **Bạn là chủ sở hữu:** Mỗi workspace bạn tạo ra đều thuộc về bạn (owner_id). Hãy xem chúng như những "thư mục" cấp cao để tổ chức các lĩnh vực khác nhau trong cuộc sống của bạn:
    - Một workspace cho "Công việc Freelance".
    - Một workspace cho "Dự án Marketing".
    - Một workspace cho "Kế hoạch Cá nhân".
- **Toàn quyền quản lý:** Bạn có thể đặt tên, tùy chỉnh và sắp xếp các dự án bên trong những không gian này theo cách của riêng bạn.
## **3. Sức Mạnh Của Sự Hợp Tác: Lời Mời Ở Cấp Độ Dự Án**
Với PronaFlow, sự hợp tác luôn diễn ra một cách trực tiếp và hiệu quả.
- **Mời vào dự án, không phải workspace:** Khi bạn muốn làm việc cùng người khác trên một dự án trong workspace "Công việc Freelance" của mình, bạn chỉ cần mời họ trực tiếp vào **Project** đó.
- **Trải nghiệm liền mạch cho đồng đội:** Ngay lập tức, dự án này sẽ xuất hiện trong Workspace Mặc Định của họ, bên cạnh các công việc khác của họ. Điều này giúp mọi người luôn tập trung vào nhiệm vụ mà không bị phân tâm bởi cấu trúc không gian làm việc của người khác.
## **4. Toàn Quyền Tác Động Trong Từng Dự Án**
Dù một dự án nằm trong workspace của bạn hay bạn được mời tham gia, bạn vẫn có đầy đủ quyền năng để hành động:
- **Tạo và quản lý tasks:** Bạn có thể tạo công việc, viết mô tả, đặt deadline, và giao việc (task_assignees) cho chính mình hoặc cho các thành viên khác trong dự án.
- **Chia nhỏ công việc với subtasks:** Mỗi công việc lớn đều có thể được chia thành các bước nhỏ, dễ quản lý hơn.
- **Phân loại với tags:** Sử dụng hệ thống nhãn (tags) của workspace gốc để giữ cho mọi thứ được tổ chức một cách nhất quán.
*Tại PronaFlow, bạn là người điều hành trung tâm chỉ huy của mình. Mọi công việc tìm đến bạn, và bạn có đủ công cụ để chinh phục chúng một cách hiệu quả và tập trung nhất.*